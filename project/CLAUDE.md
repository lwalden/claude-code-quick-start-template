# CLAUDE.md - Project Instructions

> Claude reads this file automatically at the start of every session.
> Keep it concise -- every line here costs context tokens on every session.
>
> **File Reading Order:** PROGRESS.md first → DECISIONS.md when making architectural choices → other docs on-demand.

---

## Session Protocol

### Starting a Session
1. Read `PROGRESS.md` -- understand current state and what to work on
2. Run `git status` -- check for uncommitted work from previous sessions
3. Run `gh pr list` -- check for open PRs awaiting review
4. Check "Blocked / Awaiting Human" section -- ask user about pending items
5. Resume from "Next Session Should" in PROGRESS.md

### During a Session
- Write code to files immediately -- don't accumulate large changes in memory
- Commit at natural checkpoints (compiles, tests pass, logical unit complete)
- Prefer smaller, frequent commits over one large commit at the end
- Update PROGRESS.md before starting complex multi-step operations

### Ending a Session
Run `/checkpoint` or manually:
1. Update PROGRESS.md with completed tasks, blockers, and next priorities
2. Update DECISIONS.md if any of these occurred: choosing a library/framework, designing an API, selecting an auth approach, changing a data model, making a build/deploy decision
3. Commit tracking changes

### If Session Ends Unexpectedly (Token Limits)
Files on disk and staged changes are preserved. Next session: `git status` and `git diff` show partial work.

---

## Project Identity

<!-- Generated by /setup -- replace these with actual values -->
**Project:** [Project Name]
**Description:** [Brief description]
**Type:** [web-app | api | cli-tool | library | mobile-app | other]
**Stack:** [Language / Framework / Database / etc.]

**Developer Profile:**
- [Experience level and tech expertise]
- [Availability and collaboration preferences]
- [Risk tolerance: conservative / medium / aggressive]

---

## MVP Goals

<!-- Populated by /plan -- Phase 1 deliverables. Check these before implementing features. -->
<!-- Example:
- User can register and log in
- Core CRUD operations work end-to-end
- Deployed and accessible at a public URL
-->

---

## Behavioral Rules

### Git Workflow
- **Never commit directly to main** -- always use feature branches
- Branch naming: `feature/short-description`, `fix/short-description`, `chore/short-description`
- All changes via PR. Claude creates PRs; human reviews and merges
- After human merges: `git checkout main && git pull`, then start next branch

### PR Format
- Clear title (under 70 chars), summary of what/why, test plan with verification steps
- Keep PRs reasonably sized -- prefer multiple smaller PRs over one massive PR

### Credentials
- Never store credentials in code files
- Use `.env` files (gitignored) for local development
- When you need a credential, ask: "Please provide your [SERVICE] API key. I'll store it in .env."

### Autonomy Boundaries
**You CAN autonomously:** Create files, install packages, run builds/tests, create branches and PRs, scaffold code, manage dependencies
**Ask the human first:** Create GitHub repos, merge PRs, sign up for services, provide API keys, approve major architectural changes, make billing decisions

### Communication
- Lead with a TL;DR, then provide detail
- Be proactive about dependencies: "Before X, we need Y"
- Flag risks early rather than discovering them mid-implementation

### Verification-First Development
- Before implementing a feature, confirm requirements by restating what you'll build
- Write tests appropriate to the project's quality tier (see strategy-roadmap.md)
- When the quality tier is Standard or above: write failing tests first, then implement
- Every PR should reference the acceptance criteria from strategy-roadmap.md

---

## Native Claude Code Features

This template works alongside Claude Code's built-in capabilities:

- **MEMORY.md** -- Claude Code auto-summarizes context here. This project uses PROGRESS.md instead (explicit, versioned, auditable). Do NOT write project state to MEMORY.md in this project.
- **Plan mode** (`/plan` native) -- Good for scoping a single task. Use this project's `/plan` command for full project planning (structured interview, strategy roadmap, quality tiers).
- **Compact history** -- Claude Code compresses old messages automatically. This is normal; run `/checkpoint` before context gets large to ensure work is saved to files first.
- **Hooks** -- This project includes governance hooks in `.claude/hooks/` that run automatically:
  - **Stop:** Auto-updates PROGRESS.md timestamp and creates a git checkpoint commit on session end
  - **SessionStart:** Re-injects PROGRESS.md and DECISIONS.md after context compaction or resume
  - **PreToolUse (Bash):** Guards against risky commands and auto-approves safe read-only ones
  - **PostToolUse (Write/Edit):** Auto-runs project linters/formatters after file edits (if available)
- **MCP servers** -- If `.claude/mcp.json` defines MCP servers, use them for database queries, API calls, or custom tools rather than shell commands when possible.

---

## Context Budget

Keep per-session context lean:

| File | Target Size | Action if Exceeded |
|------|------------|-------------------|
| CLAUDE.md | ~125 lines | Don't add without removing something |
| PROGRESS.md | ~15-20 lines active | Run `/archive` when it exceeds 100 lines |
| DECISIONS.md | Grows over time | Move superseded entries to `docs/archive/` |

**Session Management:**
- Use `/clear` to reset conversation when switching to an unrelated task
- For long sessions, Claude Code will auto-compact history -- this is normal
- If a session gets slow or unfocused, run `/checkpoint` and start a fresh session

**File Reading Strategy:**
- PROGRESS.md: Read every session (first thing)
- DECISIONS.md: Read before architectural choices (prevent re-debating)
- strategy-roadmap.md: Read on-demand for context
- Never read `docs/archive/*` unless asked
